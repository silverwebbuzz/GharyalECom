!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng-lazyload-image",["exports","@angular/core","rxjs","rxjs/operators"],t):t((e=e||self)["ng-lazyload-image"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,r){"use strict";function o(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function i(e,t){return function(n,r){t(n,r,e)}}function s(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var a="ng-lazyloaded",u="ng-failed-lazyloaded";function c(e,t){e.className.includes(t)||(e.className+=" "+t)}function l(){return"undefined"!=typeof window}function f(e){return Boolean(e.parentElement&&"picture"===e.parentElement.nodeName.toLowerCase())}function p(e){return"img"===e.nodeName.toLowerCase()}function m(e,t,n){return p(e)?n?e.srcset=t:e.src=t:e.style.backgroundImage="url('"+t+"')",e}function g(e){return function(t){for(var n=t.parentElement.getElementsByTagName("source"),r=0;r<n.length;r++){var o=n[r].getAttribute(e);o&&(n[r].srcset=o)}}}var d=g("defaultImage"),h=g("lazyLoad"),b=g("errorImage");function v(e){return function(t,n,r){p(t)&&f(t)&&e(t),n&&m(t,n,r)}}var y=v(d),I=v(h),O=v(b),w={"finally":function(e){return c(e.element,a)},loadImage:function(e){var t,r=e.element,o=e.useSrcset,i=e.imagePath;if(p(r)&&f(r)){var s=r.parentNode.cloneNode(!0);t=s.getElementsByTagName("img")[0],h(t),m(t,i,o)}else t=new Image,p(r)&&r.sizes&&(t.sizes=r.sizes),o?t.srcset=i:t.src=i;return n.Observable.create(function(e){t.onload=function(){e.next(i),e.complete()},t.onerror=function(t){e.error(null)}})},setErrorImage:function(e){var t=e.element,n=e.errorImagePath,r=e.useSrcset;O(t,n,r),c(t,u)},setLoadedImage:function(e){var t=e.element,n=e.imagePath,r=e.useSrcset;I(t,n,r)},setup:function(e){var t=e.element,n=e.defaultImagePath,r=e.useSrcset;y(t,n,r),function(e,t){return e.className&&e.className.includes(t)}(t,a)&&function(e,t){e.className=e.className.replace(t,"")}(t,a)}},j=function(){function e(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}return e.fromElement=function(t){var n=t.getBoundingClientRect(),r=n.left,o=n.top,i=n.right,s=n.bottom;return 0===r&&0===o&&0===i&&0===s?e.empty:new e(r,o,i,s)},e.fromWindow=function(t){return new e(0,0,t.innerWidth,t.innerHeight)},e.prototype.inflate=function(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e},e.prototype.intersectsWith=function(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom},e.prototype.getIntersectionWith=function(t){var n=Math.max(this.left,t.left),r=Math.max(this.top,t.top),o=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom);return o>=n&&i>=r?new e(n,r,o,i):e.empty},e.empty=new e(0,0,0,0),e}(),E=new WeakMap;var L=function(e){if(!e||"function"!=typeof e.addEventListener)return l()&&console.warn("`addEventListener` on "+e+" (scrollTarget) is not a function. Skipping this target"),n.empty();if(E.has(e))return E.get(e);var t,o=n.Observable.create(function(t){var n=function(e){return t.next(e)},r={passive:!0,capture:!1};return e.addEventListener("scroll",n,r),function(){return e.removeEventListener("scroll",n,r)}}),i=o.pipe(r.sampleTime(100,t),r.share(),r.startWith(""));return E.set(e,i),i},x=Object.assign({},w,{isVisible:function(e,t){var n=e.element,r=e.offset,o=e.scrollContainer;void 0===t&&(t=function(){return window});var i=j.fromElement(n);if(i===j.empty)return!1;var s=j.fromWindow(t());if(i.inflate(r),o){var a=j.fromElement(o).getIntersectionWith(s);return i.intersectsWith(a)}return i.intersectsWith(s)},getObservable:function(e){return e.scrollObservable?e.scrollObservable.pipe(r.startWith("")):e.scrollContainer?L(e.scrollContainer):L(l()?window:undefined)}});var C=function(){function e(e,r,o){this.onLoad=new t.EventEmitter,this.elementRef=e,this.ngZone=r,this.propertyChanges$=new n.ReplaySubject,this.hooks=function(e){if(!e)return x;var t={};return e.preset?Object.assign(t,e.preset):Object.assign(t,x),Object.keys(e).filter(function(e){return"preset"!==e}).forEach(function(n){t[n]=e[n]}),t}(o)}return e.prototype.ngOnChanges=function(){this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:0|this.offset,scrollContainer:this.scrollTarget,scrollObservable:this.scrollObservable})},e.prototype.ngAfterContentInit=function(){var e=this;if(!l())return null;this.ngZone.runOutsideAngular(function(){e.scrollSubscription=e.propertyChanges$.pipe(r.tap(function(t){return e.hooks.setup(t)}),r.switchMap(function(t){return e.hooks.getObservable(t).pipe(function(e,t){return function(o){return o.pipe(r.filter(function(n){return e.isVisible({element:t.element,event:n,offset:t.offset,scrollContainer:t.scrollContainer})}),r.take(1),r.mergeMap(function(){return e.loadImage(t)}),r.tap(function(n){return e.setLoadedImage({element:t.element,imagePath:n,useSrcset:t.useSrcset})}),r.map(function(){return!0}),r.catchError(function(){return e.setErrorImage(t),n.of(!1)}),r.tap(function(){return e["finally"](t)}))}}(e.hooks,t))})).subscribe(function(t){return e.onLoad.emit(t)})})},e.prototype.ngOnDestroy=function(){[this.scrollSubscription].filter(function(e){return e&&!e.isUnsubscribed}).forEach(function(e){return e.unsubscribe()})},o([t.Input("lazyLoad"),s("design:type",Object)],e.prototype,"lazyImage",void 0),o([t.Input(),s("design:type",String)],e.prototype,"defaultImage",void 0),o([t.Input(),s("design:type",String)],e.prototype,"errorImage",void 0),o([t.Input(),s("design:type",Object)],e.prototype,"scrollTarget",void 0),o([t.Input(),s("design:type",Object)],e.prototype,"scrollObservable",void 0),o([t.Input(),s("design:type",Number)],e.prototype,"offset",void 0),o([t.Input(),s("design:type",Boolean)],e.prototype,"useSrcset",void 0),o([t.Output(),s("design:type",t.EventEmitter)],e.prototype,"onLoad",void 0),e=o([t.Directive({selector:"[lazyLoad]"}),i(2,t.Optional()),i(2,t.Inject("options")),s("design:paramtypes",[t.ElementRef,t.NgZone,Object])],e)}(),S=function(){function e(){}var n;return n=e,e.forRoot=function(e){return{ngModule:n,providers:[{provide:"options",useValue:e}]}},e=n=o([t.NgModule({declarations:[C],exports:[C]})],e)}(),N=new WeakMap,z=new n.Subject;function M(e){e.forEach(function(e){return z.next(e)})}var P=function(e){if(!e.scrollContainer&&!l())return n.empty();var t={root:e.scrollContainer};e.offset&&(t.rootMargin=e.offset+"px");var o=e.scrollContainer||window,i=N.get(o);return i||(i=new IntersectionObserver(M,t),N.set(o,i)),i.observe(e.element),n.Observable.create(function(t){var n=z.pipe(r.filter(function(t){return t.target===e.element})).subscribe(t);return function(){n.unsubscribe(),i.unobserve(e.element)}})},R=Object.assign({},w,{isVisible:function(e){return e.event.isIntersecting},getObservable:function(e,t){return void 0===t&&(t=P),e.scrollObservable?e.scrollObservable:t(e)}});e.LazyLoadImageDirective=C,e.LazyLoadImageModule=S,e.intersectionObserverPreset=R,e.scrollPreset=x,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-lazyload-image.umd.min.js.map