/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Input, HostBinding, HostListener, ElementRef } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { CollapsibleTableRowDetailComponent } from '../collapsible-table-row-detail/collapsible-table-row-detail.component';
import { CollapsibleService } from '../services/collapsible.service';
export class CollapsibleTableRowComponent {
    /**
     * @param {?} el
     * @param {?} sanitizer
     * @param {?} collapsibleService
     */
    constructor(el, sanitizer, collapsibleService) {
        this.el = el;
        this.sanitizer = sanitizer;
        this.collapsibleService = collapsibleService;
        this.backgroundTransitionDuration = '0.3s';
        // transition-timing-function: easeInQuad
        this.backgroundTransitionTimingFunction = this.sanitizer
            .bypassSecurityTrustStyle(CollapsibleTableRowComponent.EASE_OUT_QUAD);
        this.isHeadRow = false;
        this.isBodyRow = false;
        this.isOddRow = false;
        this.isEvenRow = false;
        this.isParentStriped = false;
        this.isParentHighlight = false;
        this.parentAllowsSelect = false;
        this.parentAllowsSelectMultipleRows = false;
        this.parentAllowsDeselectingRows = false;
        this.dragSelection = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const elem = this.el.nativeElement;
        /** @type {?} */
        const tbody = elem.parentElement;
        if (tbody.tagName === 'TBODY') {
            /** @type {?} */
            const collapsibleTableRows = tbody.querySelectorAll('collapsible-table-row');
            for (let i = 0; i < collapsibleTableRows.length; i++) {
                /** @type {?} */
                const collapsibleTableRow = collapsibleTableRows[i];
                if (collapsibleTableRow === elem) {
                    this.index = i + 1;
                    break;
                }
            }
        }
        // retrieve parent CollapsibleTableComponent through the CollapsibleService
        this.parentCollapsibleTable = this.collapsibleService.getCollapsibleTable();
        if (this.parentCollapsibleTable != null) {
            // check if collapsible-table is marked to show striped table
            this.isParentStriped = this.parentCollapsibleTable.striped;
            // check if collapsible-table is marked to highlight current row
            this.isParentHighlight = this.parentCollapsibleTable.highlight;
            this.parentHighlightRowBackgroundColor = this.parentCollapsibleTable.highlightColor ||
                CollapsibleTableRowComponent.DEFAULT_HIGHLIGHT_ROW_COLOR;
            this.parentHighlightRowTextColor = this.parentCollapsibleTable.highlightTextColor ||
                CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR;
            // check if collapsible-table specifies the active row color
            this.activeRowBackgroundColor = this.parentCollapsibleTable.activeColor ||
                CollapsibleTableRowComponent.DEFAULT_ACTIVE_ROW_COLOR;
            this.activeRowTextColor = this.parentCollapsibleTable.activeTextColor ||
                CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR;
            // check if collapsible-table allows selecting rows
            this.parentAllowsSelect = this.parentCollapsibleTable.select;
            this.parentAllowsSelectMultipleRows = this.parentCollapsibleTable.selectMultipleRows;
            // check if collapsible-table specifies a color for the selected row
            this.selectedRowBackgroundColor = this.parentCollapsibleTable.selectColor ||
                CollapsibleTableRowComponent.DEFAULT_SELECTED_ROW_COLOR;
            this.selectedRowTextColor = this.parentCollapsibleTable.selectTextColor ||
                CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR;
            // check if collapsible-table allows to deselect rows
            this.parentAllowsDeselectingRows = this.parentCollapsibleTable.allowDeselectingRows != null ?
                this.parentCollapsibleTable.allowDeselectingRows : false;
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.updateRow();
    }
    /**
     * @return {?}
     */
    updateRow() {
        /** @type {?} */
        const elem = this.el.nativeElement;
        /** @type {?} */
        const th = elem.querySelector('th');
        if (th != null) {
            this.isHeadRow = true;
        }
        /** @type {?} */
        const td = elem.querySelector('td');
        if (td != null) {
            this.isBodyRow = true;
            // determine if the row is 'odd' or 'event'
            if (this.index % 2 === 0) {
                this.isEvenRow = true;
                this.parentStripedRowBackgroundColor = this.parentCollapsibleTable.stripedEvenColor ||
                    CollapsibleTableRowComponent.DEFAULT_STRIPED_EVEN_ROW_COLOR;
                this.parentStripedRowTextColor = this.parentCollapsibleTable.stripedEvenTextColor ||
                    CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR;
            }
            else {
                this.isOddRow = true;
                this.parentStripedRowBackgroundColor = this.parentCollapsibleTable.stripedOddColor ||
                    CollapsibleTableRowComponent.DEFAULT_STRIPED_ODD_ROW_COLOR;
                this.parentStripedRowTextColor = this.parentCollapsibleTable.stripedOddTextColor ||
                    CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR;
            }
            switch (true) {
                case this.parentAllowsSelect && this.selected:
                    this.rowBackgroundColor = this.selectedRowBackgroundColor;
                    this.rowTextColor = this.selectedRowTextColor;
                    break;
                case this.isParentStriped:
                    this.rowBackgroundColor = this.parentStripedRowBackgroundColor;
                    this.rowTextColor = this.parentStripedRowTextColor;
                    break;
            }
        }
    }
    /**
     * @return {?}
     */
    getHeight() {
        return this.el.nativeElement.offsetHeight;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    isLeftMouseButton(event) {
        /** @type {?} */
        const button = event.button;
        /** @type {?} */
        const which = event['which'];
        /** @type {?} */
        const target = /** @type {?} */ ((event.target || event.srcElement || event.currentTarget));
        if (['TR', 'TD'].indexOf(target.tagName) > -1) {
            if ('button' in event) {
                return button === 0;
            }
            else {
                return (which || button) === 1;
            }
        }
        return false;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    mousedown(event) {
        // handle only if the Left mouse button pressed
        // and the row is a body row
        if (this.isLeftMouseButton(event) && this.isBodyRow) {
            if (this.parentCollapsibleTable.noTextSelect) {
                event.preventDefault();
            }
            if (this.isBodyRow) {
                if (this.parentAllowsSelect && !this.parentAllowsDeselectingRows) {
                    this.prevSelectedRows = this.parentCollapsibleTable.selectedRows;
                    this.parentCollapsibleTable.clearSelectedRows();
                    this.parentCollapsibleTable.deselectAllRows();
                }
                this.rowBackgroundColor = this.activeRowBackgroundColor;
                this.rowTextColor = this.activeRowTextColor;
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    mouseup(event) {
        // handle only if the Left mouse button pressed
        // and the row is a body row
        if (this.isLeftMouseButton(event) && this.isBodyRow) {
            // handle selection
            if (this.parentAllowsSelect) {
                if (!this.parentAllowsDeselectingRows) {
                    this.parentCollapsibleTable.selectRow(this.index);
                }
                else {
                    if (!this.dragSelection) {
                        this.parentCollapsibleTable.toggleRowSelection(this.index);
                    }
                }
            }
            // check row state
            this.parentCollapsibleTable.updateTable();
            /*switch (true) {
                            // parent allows selecting rows and the row is selected
                            case this.parentAllowsSelect && this.selected:
                                this.rowBackgroundColor = this.selectedRowBackgroundColor;
                                this.rowTextColor = this.selectedRowTextColor;
                                this.parentCollapsibleTable.updateTable();
                                break;
                            // highlighted
                            case this.isParentHighlight:
                                this.rowBackgroundColor = this.parentHighlightRowBackgroundColor;
                                this.rowTextColor = this.parentHighlightRowTextColor;
                                break;
                            // striped
                            case this.isParentStriped:
                                this.rowBackgroundColor = this.parentStripedRowBackgroundColor;
                                this.rowTextColor = this.parentStripedRowTextColor;
                                break;
                            default:
                                this.rowBackgroundColor = undefined;
                                this.rowTextColor = undefined;
                                break;
                        }*/
            // select multiple rows using the 'Shift' key
            if (this.parentAllowsSelect &&
                this.parentAllowsSelectMultipleRows &&
                event != null && event.shiftKey) {
                if (this.prevSelectedRows != null &&
                    this.prevSelectedRows.length > 0 &&
                    this.parentCollapsibleTable.selectedRows.length > 0) {
                    /** @type {?} */
                    const rangeSelectedRows = this.prevSelectedRows.concat(this.parentCollapsibleTable.selectedRows);
                    rangeSelectedRows.sort((a, b) => a - b);
                    /** @type {?} */
                    const firstRowIndex = Math.min.apply(null, rangeSelectedRows);
                    /** @type {?} */
                    const lastRowIndex = Math.max.apply(null, rangeSelectedRows);
                    this.parentCollapsibleTable.selectRows(firstRowIndex, lastRowIndex);
                }
            }
            // set dragSelection flag to false. Prevents selection drag behavior
            this.dragSelection = false;
            // focus the collapsible table
            this.parentCollapsibleTable.focus();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    mouseenter(event) {
        // handle only if the row is a body row
        if (this.isBodyRow) {
            switch (true) {
                // the use is trying to select multiple rows by holding a mouse button
                case this.parentAllowsSelect && this.parentAllowsSelectMultipleRows && this.parentCollapsibleTable.mouseDownHold:
                    this.parentCollapsibleTable.selectRow(this.index);
                    this.dragSelection = true;
                    break;
                // parent allows selecting rows and the row is selected
                case this.parentAllowsSelect && this.selected:
                    break;
                // highlighted
                case this.isParentHighlight:
                    this.rowBackgroundColor = this.parentHighlightRowBackgroundColor;
                    this.rowTextColor = this.parentHighlightRowTextColor;
                    break;
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    mouseleave(event) {
        // handle only if the row is a body row
        if (this.isBodyRow) {
            // check row state
            switch (true) {
                // the use is trying to select multiple rows by holding a mouse button
                case this.parentAllowsSelect && this.parentAllowsSelectMultipleRows && this.parentCollapsibleTable.mouseDownHold:
                    this.parentCollapsibleTable.selectRow(this.index);
                    this.dragSelection = false;
                    break;
                // parent allows selecting rows and the row is selected
                case this.parentAllowsSelect && this.selected:
                    break;
                // stripped
                case this.isParentStriped:
                    this.rowBackgroundColor = this.parentStripedRowBackgroundColor;
                    this.rowTextColor = this.parentStripedRowTextColor;
                    break;
                default:
                    this.rowBackgroundColor = undefined;
                    this.rowTextColor = undefined;
                    break;
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    click(event) {
        if (this.detail != null) {
            /** @type {?} */
            const target = /** @type {?} */ ((event.target || event.srcElement || event.currentTarget));
            if (target != null && ['TR', 'TD'].indexOf(target.tagName) > -1) {
                this.detail.subject.next();
            }
        }
    }
}
CollapsibleTableRowComponent.EASE_OUT_QUAD = 'cubic-bezier(0.25, 0.46, 0.45, 0.94)';
CollapsibleTableRowComponent.DEFAULT_STRIPED_ODD_ROW_COLOR = 'rgba(242,242,242,0.8)';
CollapsibleTableRowComponent.DEFAULT_STRIPED_EVEN_ROW_COLOR = 'transparent';
CollapsibleTableRowComponent.DEFAULT_HIGHLIGHT_ROW_COLOR = 'rgba(222,222,222, 0.8)';
CollapsibleTableRowComponent.DEFAULT_ACTIVE_ROW_COLOR = 'rgba(212,212,212, 0.8)';
CollapsibleTableRowComponent.DEFAULT_SELECTED_ROW_COLOR = 'rgba(212,212,212, 0.8)';
CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR = 'black';
CollapsibleTableRowComponent.decorators = [
    { type: Component, args: [{
                selector: 'collapsible-table-row',
                template: `<ng-content></ng-content>`,
                styles: [`
        :host {
            display: table-row;
            transition-property: background-color, color;
        }
    `]
            }] }
];
/** @nocollapse */
CollapsibleTableRowComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: DomSanitizer },
    { type: CollapsibleService }
];
CollapsibleTableRowComponent.propDecorators = {
    detail: [{ type: Input }],
    rowTextColor: [{ type: HostBinding, args: ['style.color',] }],
    rowBackgroundColor: [{ type: HostBinding, args: ['style.background-color',] }],
    backgroundTransitionDuration: [{ type: HostBinding, args: ['style.transition-duration',] }],
    backgroundTransitionTimingFunction: [{ type: HostBinding, args: ['style.transition-timing-function',] }],
    selected: [{ type: HostBinding, args: ['class.selected',] }],
    mousedown: [{ type: HostListener, args: ['mousedown', ['$event'],] }],
    mouseup: [{ type: HostListener, args: ['mouseup', ['$event'],] }],
    mouseenter: [{ type: HostListener, args: ['mouseenter', ['$event'],] }],
    mouseleave: [{ type: HostListener, args: ['mouseleave', ['$event'],] }],
    click: [{ type: HostListener, args: ['click', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    CollapsibleTableRowComponent.EASE_OUT_QUAD;
    /** @type {?} */
    CollapsibleTableRowComponent.DEFAULT_STRIPED_ODD_ROW_COLOR;
    /** @type {?} */
    CollapsibleTableRowComponent.DEFAULT_STRIPED_EVEN_ROW_COLOR;
    /** @type {?} */
    CollapsibleTableRowComponent.DEFAULT_HIGHLIGHT_ROW_COLOR;
    /** @type {?} */
    CollapsibleTableRowComponent.DEFAULT_ACTIVE_ROW_COLOR;
    /** @type {?} */
    CollapsibleTableRowComponent.DEFAULT_SELECTED_ROW_COLOR;
    /** @type {?} */
    CollapsibleTableRowComponent.DEFAULT_ROW_TEXT_COLOR;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.detail;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.rowTextColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.rowBackgroundColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.backgroundTransitionDuration;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.backgroundTransitionTimingFunction;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.selected;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.isHeadRow;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.isBodyRow;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.isOddRow;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.isEvenRow;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.isParentStriped;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.isParentHighlight;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentAllowsSelect;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentAllowsSelectMultipleRows;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentStripedRowBackgroundColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentStripedRowTextColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentHighlightRowBackgroundColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentHighlightRowTextColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.activeRowBackgroundColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.activeRowTextColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.selectedRowBackgroundColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.selectedRowTextColor;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentAllowsDeselectingRows;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.index;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.parentCollapsibleTable;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.prevSelectedRows;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.dragSelection;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.el;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.sanitizer;
    /** @type {?} */
    CollapsibleTableRowComponent.prototype.collapsibleService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGFwc2libGUtdGFibGUtcm93LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXIyLWNvbGxhcHNpYmxlLyIsInNvdXJjZXMiOlsibGliL2NvbGxhcHNpYmxlLXRhYmxlLXJvdy9jb2xsYXBzaWJsZS10YWJsZS1yb3cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUVULEtBQUssRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUNoQyxVQUFVLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXpELE9BQU8sRUFBRSxrQ0FBa0MsRUFBRSxNQUFNLHdFQUF3RSxDQUFDO0FBRTVILE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBWXJFLE1BQU07Ozs7OztJQW1ERixZQUNZLElBQ0EsV0FDQTtRQUZBLE9BQUUsR0FBRixFQUFFO1FBQ0YsY0FBUyxHQUFULFNBQVM7UUFDVCx1QkFBa0IsR0FBbEIsa0JBQWtCOzRDQXBDMkMsTUFBTTs7a0RBRzFDLElBQUksQ0FBQyxTQUFTO2FBQzlDLHdCQUF3QixDQUFDLDRCQUE0QixDQUFDLGFBQWEsQ0FBQzt5QkFJN0QsS0FBSzt5QkFDTCxLQUFLO3dCQUNOLEtBQUs7eUJBQ0osS0FBSzsrQkFDQyxLQUFLO2lDQUNILEtBQUs7a0NBQ0osS0FBSzs4Q0FDTyxLQUFLOzJDQVVSLEtBQUs7NkJBTVgsS0FBSztLQUswQjs7OztJQUV2RCxRQUFROztRQUNKLE1BQU0sSUFBSSxHQUFZLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDOztRQUM1QyxNQUFNLEtBQUssR0FBWSxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzFDLElBQUksS0FBSyxDQUFDLE9BQU8sS0FBSyxPQUFPLEVBQUU7O1lBQzNCLE1BQU0sb0JBQW9CLEdBQXdCLEtBQUssQ0FBQyxnQkFBZ0Is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QUFFLDJCQUEyQjt5QkFDNUI7Ozs7O0tBS1I7YUFDSjs7OztZQWpCRyxVQUFVO1lBRUwsWUFBWTtZQUlaLGtCQUFrQjs7O3FCQXdCdEIsS0FBSzsyQkFFTCxXQUFXLFNBQUMsYUFBYTtpQ0FFekIsV0FBVyxTQUFDLHdCQUF3QjsyQ0FFcEMsV0FBVyxTQUFDLDJCQUEyQjtpREFFdkMsV0FBVyxTQUFDLGtDQUFrQzt1QkFJOUMsV0FBVyxTQUFDLGdCQUFnQjt3QkFvSjVCLFlBQVksU0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUM7c0JBb0JwQyxZQUFZLFNBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDO3lCQWlFbEMsWUFBWSxTQUFDLFlBQVksRUFBRSxDQUFDLFFBQVEsQ0FBQzt5QkFzQnJDLFlBQVksU0FBQyxZQUFZLEVBQUUsQ0FBQyxRQUFRLENBQUM7b0JBMkJyQyxZQUFZLFNBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDb21wb25lbnQsXG4gICAgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LFxuICAgIElucHV0LCBIb3N0QmluZGluZywgSG9zdExpc3RlbmVyLFxuICAgIEVsZW1lbnRSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcblxuaW1wb3J0IHsgQ29sbGFwc2libGVUYWJsZVJvd0RldGFpbENvbXBvbmVudCB9IGZyb20gJy4uL2NvbGxhcHNpYmxlLXRhYmxlLXJvdy1kZXRhaWwvY29sbGFwc2libGUtdGFibGUtcm93LWRldGFpbC5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29sbGFwc2libGVUYWJsZUNvbXBvbmVudCB9IGZyb20gJy4uL2NvbGxhcHNpYmxlLXRhYmxlL2NvbGxhcHNpYmxlLXRhYmxlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb2xsYXBzaWJsZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jb2xsYXBzaWJsZS5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdjb2xsYXBzaWJsZS10YWJsZS1yb3cnLFxuICAgIHRlbXBsYXRlOiBgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PmAsXG4gICAgc3R5bGVzOiBbYFxuICAgICAgICA6aG9zdCB7XG4gICAgICAgICAgICBkaXNwbGF5OiB0YWJsZS1yb3c7XG4gICAgICAgICAgICB0cmFuc2l0aW9uLXByb3BlcnR5OiBiYWNrZ3JvdW5kLWNvbG9yLCBjb2xvcjtcbiAgICAgICAgfVxuICAgIGBdLFxufSlcbmV4cG9ydCBjbGFzcyBDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0IHtcblxuICAgIHByaXZhdGUgc3RhdGljIEVBU0VfT1VUX1FVQUQgPSAnY3ViaWMtYmV6aWVyKDAuMjUsIDAuNDYsIDAuNDUsIDAuOTQpJztcblxuICAgIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9TVFJJUEVEX09ERF9ST1dfQ09MT1IgPSAncmdiYSgyNDIsMjQyLDI0MiwwLjgpJztcbiAgICBwdWJsaWMgc3RhdGljIERFRkFVTFRfU1RSSVBFRF9FVkVOX1JPV19DT0xPUiA9ICd0cmFuc3BhcmVudCc7XG4gICAgcHVibGljIHN0YXRpYyBERUZBVUxUX0hJR0hMSUdIVF9ST1dfQ09MT1IgPSAncmdiYSgyMjIsMjIyLDIyMiwgMC44KSc7XG4gICAgcHVibGljIHN0YXRpYyBERUZBVUxUX0FDVElWRV9ST1dfQ09MT1IgPSAncmdiYSgyMTIsMjEyLDIxMiwgMC44KSc7XG4gICAgcHVibGljIHN0YXRpYyBERUZBVUxUX1NFTEVDVEVEX1JPV19DT0xPUiA9ICdyZ2JhKDIxMiwyMTIsMjEyLCAwLjgpJztcblxuICAgIHB1YmxpYyBzdGF0aWMgREVGQVVMVF9ST1dfVEVYVF9DT0xPUiA9ICdibGFjayc7XG5cbiAgICBASW5wdXQoKSBkZXRhaWw6IENvbGxhcHNpYmxlVGFibGVSb3dEZXRhaWxDb21wb25lbnQ7XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLmNvbG9yJykgcm93VGV4dENvbG9yOiBzdHJpbmc7XG5cbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLmJhY2tncm91bmQtY29sb3InKSByb3dCYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcblxuICAgIEBIb3N0QmluZGluZygnc3R5bGUudHJhbnNpdGlvbi1kdXJhdGlvbicpIGJhY2tncm91bmRUcmFuc2l0aW9uRHVyYXRpb24gPSAnMC4zcyc7XG4gICAgLy8gdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb246IGVhc2VJblF1YWRcbiAgICBASG9zdEJpbmRpbmcoJ3N0eWxlLnRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uJylcbiAgICBiYWNrZ3JvdW5kVHJhbnNpdGlvblRpbWluZ0Z1bmN0aW9uID0gdGhpcy5zYW5pdGl6ZXJcbiAgICAgICAgLmJ5cGFzc1NlY3VyaXR5VHJ1c3RTdHlsZShDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50LkVBU0VfT1VUX1FVQUQpO1xuXG4gICAgQEhvc3RCaW5kaW5nKCdjbGFzcy5zZWxlY3RlZCcpIHNlbGVjdGVkOiBib29sZWFuO1xuXG4gICAgaXNIZWFkUm93ID0gZmFsc2U7XG4gICAgaXNCb2R5Um93ID0gZmFsc2U7XG4gICAgaXNPZGRSb3cgPSBmYWxzZTtcbiAgICBpc0V2ZW5Sb3cgPSBmYWxzZTtcbiAgICBpc1BhcmVudFN0cmlwZWQgPSBmYWxzZTtcbiAgICBpc1BhcmVudEhpZ2hsaWdodCA9IGZhbHNlO1xuICAgIHBhcmVudEFsbG93c1NlbGVjdCA9IGZhbHNlO1xuICAgIHBhcmVudEFsbG93c1NlbGVjdE11bHRpcGxlUm93cyA9IGZhbHNlO1xuXG4gICAgcGFyZW50U3RyaXBlZFJvd0JhY2tncm91bmRDb2xvcjogc3RyaW5nO1xuICAgIHBhcmVudFN0cmlwZWRSb3dUZXh0Q29sb3I6IHN0cmluZztcbiAgICBwYXJlbnRIaWdobGlnaHRSb3dCYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcbiAgICBwYXJlbnRIaWdobGlnaHRSb3dUZXh0Q29sb3I6IHN0cmluZztcbiAgICBhY3RpdmVSb3dCYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcbiAgICBhY3RpdmVSb3dUZXh0Q29sb3I6IHN0cmluZztcbiAgICBzZWxlY3RlZFJvd0JhY2tncm91bmRDb2xvcjogc3RyaW5nO1xuICAgIHNlbGVjdGVkUm93VGV4dENvbG9yOiBzdHJpbmc7XG4gICAgcGFyZW50QWxsb3dzRGVzZWxlY3RpbmdSb3dzID0gZmFsc2U7XG5cbiAgICBpbmRleDogbnVtYmVyO1xuXG4gICAgcHJpdmF0ZSBwYXJlbnRDb2xsYXBzaWJsZVRhYmxlOiBDb2xsYXBzaWJsZVRhYmxlQ29tcG9uZW50O1xuICAgIHByaXZhdGUgcHJldlNlbGVjdGVkUm93czogQXJyYXk8bnVtYmVyPjtcbiAgICBwcml2YXRlIGRyYWdTZWxlY3Rpb24gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgICAgICBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyLFxuICAgICAgICBwcml2YXRlIGNvbGxhcHNpYmxlU2VydmljZTogQ29sbGFwc2libGVTZXJ2aWNlKSB7IH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBjb25zdCBlbGVtOiBFbGVtZW50ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBjb25zdCB0Ym9keTogRWxlbWVudCA9IGVsZW0ucGFyZW50RWxlbWVudDtcbiAgICAgICAgaWYgKHRib2R5LnRhZ05hbWUgPT09ICdUQk9EWScpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxhcHNpYmxlVGFibGVSb3dzOiBOb2RlTGlzdE9mPEVsZW1lbnQ+ID0gdGJvZHkucXVlcnlTZWxlY3RvckFsbCgnY29sbGFwc2libGUtdGFibGUtcm93Jyk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbGxhcHNpYmxlVGFibGVSb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sbGFwc2libGVUYWJsZVJvdzogRWxlbWVudCA9IGNvbGxhcHNpYmxlVGFibGVSb3dzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChjb2xsYXBzaWJsZVRhYmxlUm93ID09PSBlbGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5kZXggPSBpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmV0cmlldmUgcGFyZW50IENvbGxhcHNpYmxlVGFibGVDb21wb25lbnQgdGhyb3VnaCB0aGUgQ29sbGFwc2libGVTZXJ2aWNlXG4gICAgICAgIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZSA9IHRoaXMuY29sbGFwc2libGVTZXJ2aWNlLmdldENvbGxhcHNpYmxlVGFibGUoKTtcblxuICAgICAgICBpZiAodGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlICE9IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGNvbGxhcHNpYmxlLXRhYmxlIGlzIG1hcmtlZCB0byBzaG93IHN0cmlwZWQgdGFibGVcbiAgICAgICAgICAgIHRoaXMuaXNQYXJlbnRTdHJpcGVkID0gdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLnN0cmlwZWQ7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGNvbGxhcHNpYmxlLXRhYmxlIGlzIG1hcmtlZCB0byBoaWdobGlnaHQgY3VycmVudCByb3dcbiAgICAgICAgICAgIHRoaXMuaXNQYXJlbnRIaWdobGlnaHQgPSB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuaGlnaGxpZ2h0O1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRIaWdobGlnaHRSb3dCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuaGlnaGxpZ2h0Q29sb3IgfHxcbiAgICAgICAgICAgICAgICBDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50LkRFRkFVTFRfSElHSExJR0hUX1JPV19DT0xPUjtcbiAgICAgICAgICAgIHRoaXMucGFyZW50SGlnaGxpZ2h0Um93VGV4dENvbG9yID0gdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLmhpZ2hsaWdodFRleHRDb2xvciB8fFxuICAgICAgICAgICAgICAgIENvbGxhcHNpYmxlVGFibGVSb3dDb21wb25lbnQuREVGQVVMVF9ST1dfVEVYVF9DT0xPUjtcblxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgY29sbGFwc2libGUtdGFibGUgc3BlY2lmaWVzIHRoZSBhY3RpdmUgcm93IGNvbG9yXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZVJvd0JhY2tncm91bmRDb2xvciA9IHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5hY3RpdmVDb2xvciB8fFxuICAgICAgICAgICAgICAgIENvbGxhcHNpYmxlVGFibGVSb3dDb21wb25lbnQuREVGQVVMVF9BQ1RJVkVfUk9XX0NPTE9SO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVSb3dUZXh0Q29sb3IgPSB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuYWN0aXZlVGV4dENvbG9yIHx8XG4gICAgICAgICAgICAgICAgQ29sbGFwc2libGVUYWJsZVJvd0NvbXBvbmVudC5ERUZBVUxUX1JPV19URVhUX0NPTE9SO1xuXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBjb2xsYXBzaWJsZS10YWJsZSBhbGxvd3Mgc2VsZWN0aW5nIHJvd3NcbiAgICAgICAgICAgIHRoaXMucGFyZW50QWxsb3dzU2VsZWN0ID0gdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLnNlbGVjdDtcbiAgICAgICAgICAgIHRoaXMucGFyZW50QWxsb3dzU2VsZWN0TXVsdGlwbGVSb3dzID0gdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLnNlbGVjdE11bHRpcGxlUm93cztcblxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgY29sbGFwc2libGUtdGFibGUgc3BlY2lmaWVzIGEgY29sb3IgZm9yIHRoZSBzZWxlY3RlZCByb3dcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSb3dCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuc2VsZWN0Q29sb3IgfHxcbiAgICAgICAgICAgICAgICBDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50LkRFRkFVTFRfU0VMRUNURURfUk9XX0NPTE9SO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFJvd1RleHRDb2xvciA9IHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zZWxlY3RUZXh0Q29sb3IgfHxcbiAgICAgICAgICAgICAgICBDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50LkRFRkFVTFRfUk9XX1RFWFRfQ09MT1I7XG5cbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGNvbGxhcHNpYmxlLXRhYmxlIGFsbG93cyB0byBkZXNlbGVjdCByb3dzXG4gICAgICAgICAgICB0aGlzLnBhcmVudEFsbG93c0Rlc2VsZWN0aW5nUm93cyA9IHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5hbGxvd0Rlc2VsZWN0aW5nUm93cyAhPSBudWxsID9cbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuYWxsb3dEZXNlbGVjdGluZ1Jvd3MgOiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy51cGRhdGVSb3coKTtcbiAgICB9XG5cbiAgICB1cGRhdGVSb3coKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGVsZW06IEVsZW1lbnQgPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoZSByb3cgaXMgaW5zaWRlIHRoZSAndGhlYWQnXG4gICAgICAgIGNvbnN0IHRoID0gZWxlbS5xdWVyeVNlbGVjdG9yKCd0aCcpO1xuICAgICAgICBpZiAodGggIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5pc0hlYWRSb3cgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoZSByb3cgaXMgaW5zaWRlIHRoZSAndGJvZHknXG4gICAgICAgIGNvbnN0IHRkID0gZWxlbS5xdWVyeVNlbGVjdG9yKCd0ZCcpO1xuICAgICAgICBpZiAodGQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5pc0JvZHlSb3cgPSB0cnVlO1xuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIHRoZSByb3cgaXMgJ29kZCcgb3IgJ2V2ZW50J1xuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXggJSAyID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc0V2ZW5Sb3cgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U3RyaXBlZFJvd0JhY2tncm91bmRDb2xvciA9IHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zdHJpcGVkRXZlbkNvbG9yIHx8XG4gICAgICAgICAgICAgICAgICAgIENvbGxhcHNpYmxlVGFibGVSb3dDb21wb25lbnQuREVGQVVMVF9TVFJJUEVEX0VWRU5fUk9XX0NPTE9SO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U3RyaXBlZFJvd1RleHRDb2xvciA9IHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zdHJpcGVkRXZlblRleHRDb2xvciB8fFxuICAgICAgICAgICAgICAgICAgICBDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50LkRFRkFVTFRfUk9XX1RFWFRfQ09MT1I7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNPZGRSb3cgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50U3RyaXBlZFJvd0JhY2tncm91bmRDb2xvciA9IHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zdHJpcGVkT2RkQ29sb3IgfHxcbiAgICAgICAgICAgICAgICAgICAgQ29sbGFwc2libGVUYWJsZVJvd0NvbXBvbmVudC5ERUZBVUxUX1NUUklQRURfT0REX1JPV19DT0xPUjtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFN0cmlwZWRSb3dUZXh0Q29sb3IgPSB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuc3RyaXBlZE9kZFRleHRDb2xvciB8fFxuICAgICAgICAgICAgICAgICAgICBDb2xsYXBzaWJsZVRhYmxlUm93Q29tcG9uZW50LkRFRkFVTFRfUk9XX1RFWFRfQ09MT1I7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5wYXJlbnRBbGxvd3NTZWxlY3QgJiYgdGhpcy5zZWxlY3RlZDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnNlbGVjdGVkUm93QmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd1RleHRDb2xvciA9IHRoaXMuc2VsZWN0ZWRSb3dUZXh0Q29sb3I7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5pc1BhcmVudFN0cmlwZWQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm93QmFja2dyb3VuZENvbG9yID0gdGhpcy5wYXJlbnRTdHJpcGVkUm93QmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd1RleHRDb2xvciA9IHRoaXMucGFyZW50U3RyaXBlZFJvd1RleHRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldEhlaWdodCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5lbC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzTGVmdE1vdXNlQnV0dG9uKGV2ZW50OiBNb3VzZUV2ZW50KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbjogbnVtYmVyID0gZXZlbnQuYnV0dG9uO1xuICAgICAgICBjb25zdCB3aGljaDogbnVtYmVyID0gZXZlbnRbJ3doaWNoJ107XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IDxIVE1MRWxlbWVudD4oZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQgfHwgZXZlbnQuY3VycmVudFRhcmdldCk7XG5cbiAgICAgICAgaWYgKFsnVFInLCAnVEQnXS5pbmRleE9mKHRhcmdldC50YWdOYW1lKSA+IC0xKSB7XG4gICAgICAgICAgICBpZiAoJ2J1dHRvbicgaW4gZXZlbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uID09PSAwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHdoaWNoIHx8IGJ1dHRvbikgPT09IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2Vkb3duJywgWyckZXZlbnQnXSlcbiAgICBtb3VzZWRvd24oZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICAgICAgLy8gaGFuZGxlIG9ubHkgaWYgdGhlIExlZnQgbW91c2UgYnV0dG9uIHByZXNzZWRcbiAgICAgICAgLy8gYW5kIHRoZSByb3cgaXMgYSBib2R5IHJvd1xuICAgICAgICBpZiAodGhpcy5pc0xlZnRNb3VzZUJ1dHRvbihldmVudCkgJiYgdGhpcy5pc0JvZHlSb3cpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUubm9UZXh0U2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQm9keVJvdykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudEFsbG93c1NlbGVjdCAmJiAhdGhpcy5wYXJlbnRBbGxvd3NEZXNlbGVjdGluZ1Jvd3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmV2U2VsZWN0ZWRSb3dzID0gdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLnNlbGVjdGVkUm93cztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLmNsZWFyU2VsZWN0ZWRSb3dzKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5kZXNlbGVjdEFsbFJvd3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yb3dCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLmFjdGl2ZVJvd0JhY2tncm91bmRDb2xvcjtcbiAgICAgICAgICAgICAgICB0aGlzLnJvd1RleHRDb2xvciA9IHRoaXMuYWN0aXZlUm93VGV4dENvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcignbW91c2V1cCcsIFsnJGV2ZW50J10pXG4gICAgbW91c2V1cChldmVudDogTW91c2VFdmVudCkge1xuICAgICAgICAvLyBoYW5kbGUgb25seSBpZiB0aGUgTGVmdCBtb3VzZSBidXR0b24gcHJlc3NlZFxuICAgICAgICAvLyBhbmQgdGhlIHJvdyBpcyBhIGJvZHkgcm93XG4gICAgICAgIGlmICh0aGlzLmlzTGVmdE1vdXNlQnV0dG9uKGV2ZW50KSAmJiB0aGlzLmlzQm9keVJvdykge1xuICAgICAgICAgICAgLy8gaGFuZGxlIHNlbGVjdGlvblxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50QWxsb3dzU2VsZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnBhcmVudEFsbG93c0Rlc2VsZWN0aW5nUm93cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuc2VsZWN0Um93KHRoaXMuaW5kZXgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5kcmFnU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUudG9nZ2xlUm93U2VsZWN0aW9uKHRoaXMuaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjaGVjayByb3cgc3RhdGVcbiAgICAgICAgICAgIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS51cGRhdGVUYWJsZSgpO1xuICAgICAgICAgICAgLypzd2l0Y2ggKHRydWUpIHtcbiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgYWxsb3dzIHNlbGVjdGluZyByb3dzIGFuZCB0aGUgcm93IGlzIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnBhcmVudEFsbG93c1NlbGVjdCAmJiB0aGlzLnNlbGVjdGVkOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd0JhY2tncm91bmRDb2xvciA9IHRoaXMuc2VsZWN0ZWRSb3dCYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm93VGV4dENvbG9yID0gdGhpcy5zZWxlY3RlZFJvd1RleHRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLnVwZGF0ZVRhYmxlKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIC8vIGhpZ2hsaWdodGVkXG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLmlzUGFyZW50SGlnaGxpZ2h0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd0JhY2tncm91bmRDb2xvciA9IHRoaXMucGFyZW50SGlnaGxpZ2h0Um93QmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd1RleHRDb2xvciA9IHRoaXMucGFyZW50SGlnaGxpZ2h0Um93VGV4dENvbG9yO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAvLyBzdHJpcGVkXG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLmlzUGFyZW50U3RyaXBlZDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnBhcmVudFN0cmlwZWRSb3dCYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm93VGV4dENvbG9yID0gdGhpcy5wYXJlbnRTdHJpcGVkUm93VGV4dENvbG9yO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd0JhY2tncm91bmRDb2xvciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dUZXh0Q29sb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfSovXG5cbiAgICAgICAgICAgIC8vIHNlbGVjdCBtdWx0aXBsZSByb3dzIHVzaW5nIHRoZSAnU2hpZnQnIGtleVxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50QWxsb3dzU2VsZWN0ICYmXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRBbGxvd3NTZWxlY3RNdWx0aXBsZVJvd3MgJiZcbiAgICAgICAgICAgICAgICBldmVudCAhPSBudWxsICYmIGV2ZW50LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldlNlbGVjdGVkUm93cyAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJldlNlbGVjdGVkUm93cy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zZWxlY3RlZFJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nZVNlbGVjdGVkUm93cyA9IHRoaXMucHJldlNlbGVjdGVkUm93cy5jb25jYXQodGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLnNlbGVjdGVkUm93cyk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlU2VsZWN0ZWRSb3dzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlyc3RSb3dJbmRleCA9IE1hdGgubWluLmFwcGx5KG51bGwsIHJhbmdlU2VsZWN0ZWRSb3dzKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdFJvd0luZGV4ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgcmFuZ2VTZWxlY3RlZFJvd3MpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zZWxlY3RSb3dzKGZpcnN0Um93SW5kZXgsIGxhc3RSb3dJbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzZXQgZHJhZ1NlbGVjdGlvbiBmbGFnIHRvIGZhbHNlLiBQcmV2ZW50cyBzZWxlY3Rpb24gZHJhZyBiZWhhdmlvclxuICAgICAgICAgICAgdGhpcy5kcmFnU2VsZWN0aW9uID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIGZvY3VzIHRoZSBjb2xsYXBzaWJsZSB0YWJsZVxuICAgICAgICAgICAgdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWVudGVyJywgWyckZXZlbnQnXSlcbiAgICBtb3VzZWVudGVyKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIC8vIGhhbmRsZSBvbmx5IGlmIHRoZSByb3cgaXMgYSBib2R5IHJvd1xuICAgICAgICBpZiAodGhpcy5pc0JvZHlSb3cpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIC8vIHRoZSB1c2UgaXMgdHJ5aW5nIHRvIHNlbGVjdCBtdWx0aXBsZSByb3dzIGJ5IGhvbGRpbmcgYSBtb3VzZSBidXR0b25cbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMucGFyZW50QWxsb3dzU2VsZWN0ICYmIHRoaXMucGFyZW50QWxsb3dzU2VsZWN0TXVsdGlwbGVSb3dzICYmIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5tb3VzZURvd25Ib2xkOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudENvbGxhcHNpYmxlVGFibGUuc2VsZWN0Um93KHRoaXMuaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYWdTZWxlY3Rpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgYWxsb3dzIHNlbGVjdGluZyByb3dzIGFuZCB0aGUgcm93IGlzIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnBhcmVudEFsbG93c1NlbGVjdCAmJiB0aGlzLnNlbGVjdGVkOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAvLyBoaWdobGlnaHRlZFxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5pc1BhcmVudEhpZ2hsaWdodDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dCYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLnBhcmVudEhpZ2hsaWdodFJvd0JhY2tncm91bmRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dUZXh0Q29sb3IgPSB0aGlzLnBhcmVudEhpZ2hsaWdodFJvd1RleHRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdtb3VzZWxlYXZlJywgWyckZXZlbnQnXSlcbiAgICBtb3VzZWxlYXZlKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIC8vIGhhbmRsZSBvbmx5IGlmIHRoZSByb3cgaXMgYSBib2R5IHJvd1xuICAgICAgICBpZiAodGhpcy5pc0JvZHlSb3cpIHtcbiAgICAgICAgICAgIC8vIGNoZWNrIHJvdyBzdGF0ZVxuICAgICAgICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgLy8gdGhlIHVzZSBpcyB0cnlpbmcgdG8gc2VsZWN0IG11bHRpcGxlIHJvd3MgYnkgaG9sZGluZyBhIG1vdXNlIGJ1dHRvblxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5wYXJlbnRBbGxvd3NTZWxlY3QgJiYgdGhpcy5wYXJlbnRBbGxvd3NTZWxlY3RNdWx0aXBsZVJvd3MgJiYgdGhpcy5wYXJlbnRDb2xsYXBzaWJsZVRhYmxlLm1vdXNlRG93bkhvbGQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Q29sbGFwc2libGVUYWJsZS5zZWxlY3RSb3codGhpcy5pbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1NlbGVjdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAvLyBwYXJlbnQgYWxsb3dzIHNlbGVjdGluZyByb3dzIGFuZCB0aGUgcm93IGlzIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLnBhcmVudEFsbG93c1NlbGVjdCAmJiB0aGlzLnNlbGVjdGVkOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAvLyBzdHJpcHBlZFxuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5pc1BhcmVudFN0cmlwZWQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm93QmFja2dyb3VuZENvbG9yID0gdGhpcy5wYXJlbnRTdHJpcGVkUm93QmFja2dyb3VuZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd1RleHRDb2xvciA9IHRoaXMucGFyZW50U3RyaXBlZFJvd1RleHRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3dCYWNrZ3JvdW5kQ29sb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm93VGV4dENvbG9yID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSlcbiAgICBjbGljayhldmVudDogTW91c2VFdmVudCkge1xuICAgICAgICBpZiAodGhpcy5kZXRhaWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gPEhUTUxFbGVtZW50PihldmVudC50YXJnZXQgfHwgZXZlbnQuc3JjRWxlbWVudCB8fCBldmVudC5jdXJyZW50VGFyZ2V0KTtcblxuICAgICAgICAgICAgaWYgKHRhcmdldCAhPSBudWxsICYmIFsnVFInLCAnVEQnXS5pbmRleE9mKHRhcmdldC50YWdOYW1lKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZXRhaWwuc3ViamVjdC5uZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbiJdfQ==